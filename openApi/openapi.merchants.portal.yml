openapi: 3.0.1
info:
  title: IDPAY ITN Welfare Portal Merchant API
  description: IDPAY ITN Welfare Portal Merchant
  version: 1.0.1
  contact:
    name: PagoPA S.p.A.
    url: https://www.pagopa.it
    email: support@pagopa.it
servers:
  - url: "https://api-io.dev.cstar.pagopa.it/idpay-itn/merchant/portal"
    x-internal: true

tags:
  - name: point-of-sales
    description: Operations on merchant points of sale

paths:
  /{merchantId}/point-of-sales:
    put:
      tags:
        - point-of-sales
      summary: Save or update a list of points of sale
      description: Save or update a list of points of sale fo the specified merchant
      operationId: putPointOfSales
      parameters:
        - name: merchantId
          in: path
          description: The merchant ID
          required: true
          schema:
            type: string
            maxLength: 100000
      requestBody:
        description: List of points of sale to save or update
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/PointOfSaleDTO"
      responses:
        "204":
          description: No Content - Successfully saved or updated
          headers:
            Access-Control-Allow-Origin:
              $ref: "#/components/headers/Access-Control-Allow-Origin"
            X-RateLimit-Limit:
              $ref: "#/components/headers/X-RateLimit-Limit"
            X-RateLimit-Remaining:
              $ref: "#/components/headers/X-RateLimit-Remaining"
            X-RateLimit-Reset:
              $ref: "#/components/headers/X-RateLimit-Reset"
        "400":
          description: Bad request - Invalid input data
          headers:
            Access-Control-Allow-Origin:
              $ref: "#/components/headers/Access-Control-Allow-Origin"
            X-RateLimit-Limit:
              $ref: "#/components/headers/X-RateLimit-Limit"
            X-RateLimit-Remaining:
              $ref: "#/components/headers/X-RateLimit-Remaining"
            X-RateLimit-Reset:
              $ref: "#/components/headers/X-RateLimit-Reset"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ValidationErrorDTO"
        "401":
          description: Unauthorized - Authentication failed
          headers:
            Access-Control-Allow-Origin:
              $ref: "#/components/headers/Access-Control-Allow-Origin"
            X-RateLimit-Limit:
              $ref: "#/components/headers/X-RateLimit-Limit"
            X-RateLimit-Remaining:
              $ref: "#/components/headers/X-RateLimit-Remaining"
            X-RateLimit-Reset:
              $ref: "#/components/headers/X-RateLimit-Reset"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleErrorDTO"
              example:
                code: POINT_OF_SALE_GENERIC_ERROR
                message: Authentication failed
        "404":
          description: Not Found
          headers:
            Access-Control-Allow-Origin:
              $ref: "#/components/headers/Access-Control-Allow-Origin"
            X-RateLimit-Limit:
              $ref: "#/components/headers/X-RateLimit-Limit"
            X-RateLimit-Remaining:
              $ref: "#/components/headers/X-RateLimit-Remaining"
            X-RateLimit-Reset:
              $ref: "#/components/headers/X-RateLimit-Reset"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleErrorDTO"
              example:
                "code": POINT_OF_SALE_NOT_FOUND
                message: Point of sale with id 123 not found.
        "429":
          description: Too many Request - Rate limit exceeded
          headers:
            Access-Control-Allow-Origin:
              $ref: "#/components/headers/Access-Control-Allow-Origin"
            X-RateLimit-Limit:
              $ref: "#/components/headers/X-RateLimit-Limit"
            X-RateLimit-Remaining:
              $ref: "#/components/headers/X-RateLimit-Remaining"
            X-RateLimit-Reset:
              $ref: "#/components/headers/X-RateLimit-Reset"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleErrorDTO"
              example:
                code: POINT_OF_SALE_TOO_MANY_REQUESTS
                message: Too many requests
        "500":
          description: Internal Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleErrorDTO"
              example:
                code: POINT_OF_SALE_GENERIC_ERROR
                message: An internal error occured
    get:
      tags:
        - point-of-sales
      summary: Retrieve a list of points of sale
      description: "Returns a paginated list of points of sale for the specified merchant, with optional filters."
      operationId: getPointOfSales
      parameters:
        - name: merchantId
          in: path
          description: The merchant ID
          required: true
          schema:
            type: string
            maxLength: 255
        - name: type
          in: query
          description: Filter by point of sale type
          required: false
          schema:
            type: string
            enum:
              - PHYSICAL
              - ONLINE
        - name: city
          in: query
          description: Filter by city
          required: false
          schema:
            type: string
            maxLength: 255
        - name: address
          in: query
          description: Filter by full address
          required: false
          schema:
            type: string
            maxLength: 255
        - name: contactName
          in: query
          description: Filter by contact person's name
          required: false
          schema:
            type: string
            maxLength: 255
        - name: page
          in: query
          description: Page number for pagination
          required: false
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 1000000
        - name: size
          in: query
          description: Number of elements per page
          required: false
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 1000000
        - name: sort
          in: query
          description: Sorting criteria
          required: false
          schema:
            type: string
            maxLength: 255
      responses:
        "200":
          description: Successful response with a paginated list of points of sale
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ListPointOfSaleDTO"
        "400":
          description: Bad request - Invalid query parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleErrorDTO"
              example:
                code: POINT_OF_SALE_BAD_REQUEST
                message: Something went wrong handling request
        "401":
          description: Unauthorized - Authentication Failed
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleErrorDTO"
              example:
                code: POINT_OF_SALE_NOT_FOUND
                message: Point of sale with id 123 not found.
        "429":
          description: Too many Request - Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleErrorDTO"
              example:
                code: POINT_OF_SALE_TOO_MANY_REQUESTS
                message: Too many requests
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleErrorDTO"
              example:
                code: POINT_OF_SALE_GENERIC_ERROR
                message: An error occurred during file reading
  /{merchantId}/point-of-sales/{pointOfSaleId}:
    get:
      tags:
        - point-of-sales
      summary: Retrieve a point of sale
      description: "Return a point of sale for the specified merchant."
      operationId: getPointOfSale
      parameters:
        - name: merchantId
          in: path
          description: The merchant ID
          required: true
          schema:
            type: string
        - name: pointOfSaleId
          in: path
          description: The point of sale ID
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Successful response with point of sale detail
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleDTO"
        "400":
          description: Bad request - Invalid query parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleErrorDTO"
              example:
                code: POINT_OF_SALE_BAD_REQUEST
                message: Something went wrong handling request
        "401":
          description: Unauthorized - Authentication Failed
        "404":
          description: Not Found
          headers:
            X-RateLimit-Limit:
              description: The number of allowed requests in the current period
              schema:
                type: integer
            X-RateLimit-Remaining:
              description: The number of remaining requests in the current period
              schema:
                type: integer
            X-RateLimit-Reset:
              description: The number of seconds left in the current period
              schema:
                type: integer
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleErrorDTO"
              example:
                code: POINT_OF_SALE_NOT_FOUND
                message: Point of sale with id 123 not found.
        "429":
          description: Too many Request - Rate limit exceeded
          headers:
            X-RateLimit-Limit:
              description: The number of allowed requests in the current period
              schema:
                type: integer
            X-RateLimit-Remaining:
              description: The number of remaining requests in the current period
              schema:
                type: integer
            X-RateLimit-Reset:
              description: The number of seconds left in the current period
              schema:
                type: integer
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleErrorDTO"
              example:
                code: POINT_OF_SALE_TOO_MANY_REQUESTS
                message: Too many requests
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleErrorDTO"
              example:
                code: POINT_OF_SALE_GENERIC_ERROR
                message: An error occurred during file reading
  /initiatives/{initiativeId}/point-of-sales/{pointOfSaleId}/transactions/processed:
    get:
      tags:
        - point-of-sale-transactions
      summary: "ENG: Returns the list of processed transactions associated to a point of sale - IT: Ritorna la lista delle transazioni processate associate ad un punto vendita"
      description: "ENG: Returns the list of processed transactions associated to a point of sale <br> IT: Ritorna la lista delle transazioni processate associate ad un punto vendita"
      operationId: getPointOfSaleTransactionsProcessed
      parameters:
        - name: initiativeId
          in: path
          description: The initiative ID
          required: true
          schema:
            type: string
            maxLength: 36
            pattern: .*
        - name: pointOfSaleId
          in: path
          description: The point of sale ID
          required: true
          schema:
            type: string
            maxLength: 36
            pattern: .*
        - name: page
          in: query
          required: false
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 10000
        - name: size
          in: query
          required: false
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 1000
        - name: sort
          in: query
          required: false
          schema:
            type: string
            enum:
              - trxChargeDate, desc
              - status, desc
              - productName, desc
              - trxChargeDate, asc
              - status, asc
              - productName, asc
        - name: fiscalCode
          in: query
          description: Fiscal Code
          required: false
          schema:
            type: string
            minLength: 16
            maxLength: 16
            pattern: '^[A-Z0-9]+$'
        - name: status
          in: query
          description: Transaction processed status
          required: false
          schema:
            type: string
            enum:
              - REWARDED
              - CANCELLED
              - REFUNDED
              - INVOICED
        - name: productGtin
          in: query
          required: false
          schema:
            type: string
            maxLength: 14
            pattern: ^[a-zA-Z0-9]{1,14}$
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointOfSaleTransactionsProcessedListDTO"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: "PAYMENT_INVALID_REQUEST"
                message: "Something went wrong handling the request"
        "401":
          description: Authentication failed
        "429":
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: "PAYMENT_TOO_MANY_REQUESTS"
                message: "Too many requests"
        "500":
          description: Generic error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: "PAYMENT_GENERIC_ERROR"
                message: "Application error"
  /initiatives:
    get:
      tags:
        - merchant-initiatives
      summary: "ENG: Returns the list of initiatives of a specific merchant - IT: Ritorna la lista delle iniziative di uno specifico merchant"
      description: Returns the list of initiatives of a specific merchant
      operationId: getMerchantInitiativeList
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/InitiativeDTO"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantErrorDTO"
              example:
                code: MERCHANT_INVALID_REQUEST
                message: Something went wrong handling request
        "401":
          description: Authentication failed
        "429":
          description: Too Many Requests
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantErrorDTO"
              example:
                code: MERCHANT_TOO_MANY_REQUESTS
                message: Too many requests
        "500":
          description: Server ERROR
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantErrorDTO"
              example:
                code: MERCHANT_GENERIC_ERROR
                message: An error occurred
  /initiatives/{initiativeId}/statistics:
    get:
      tags:
        - merchant-initiative-statistics
      summary: "ENG: Returns the merchant statistics on the initiative - IT: Ritorna le statistiche dell'esercente sull'iniziativa"
      description: Returns the merchant statistics on the initiative
      operationId: getMerchantInitiativeStatistics
      parameters:
        - name: initiativeId
          in: path
          description: The initiative ID
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantStatisticsDTO"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatisticsErrorDTO"
              example:
                code: STATISTICS_INVALID_REQUEST
                message: Something went wrong handling request
        "401":
          description: Authentication failed
        "404":
          description: The requested ID was not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatisticsErrorDTO"
              example:
                code: STATISTICS_NOT_FOUND
                message: Stats not found
        "429":
          description: Too many Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatisticsErrorDTO"
              example:
                code: STATISTICS_MANAGER_TOO_MANY_REQUESTS
                message: Too many requests
        "500":
          description: Server ERROR
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatisticsErrorDTO"
              example:
                code: STATISTICS_MANAGER_GENERIC_ERROR
                message: Application error
  /initiatives/{initiativeId}/reward-batches:
    get:
      tags:
        - reward-batches
      summary: "ENG: Merchant get reward batches - IT: Recupero dei lotti delle transazioni da parte dell'esercente"
      operationId: getRewardBatches
      parameters:
        - name: initiativeId
          in: path
          description: The initiative ID
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Successful response with reward batches
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RewardBatchListDTO"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RewardBatchErrorDTO"
              example:
                code: PAYMENT_INVALID_REQUEST
                message: Something went wrong handling the request
        "401":
          description: Authentication failed
        "404":
          description: The requested resource was not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RewardBatchErrorDTO"
              example:
                code: REWARD_BATCH_NOT_FOUND
                message: "Cannot find Reward Batch with initiative with id [%s]"
        "429":
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RewardBatchErrorDTO"
              example:
                code: REWARD_BATCH_TOO_MANY_REQUESTS
                message: Too many requests
        "500":
          description: Generic error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RewardBatchErrorDTO"
              example:
                code: REWARD_BATCH_GENERIC_ERROR
                message: Application error
  /transactions:
    post:
      tags:
        - merchant-transactions
      summary: "ENG: Merchant create transaction - IT: Creazione transazione da parte dell'esercente"
      operationId: createTransaction
      requestBody:
        description: General information about Transaction
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TransactionCreationRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionResponse"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_INVALID_REQUEST
                message: Something went wrong handling the request
        "401":
          description: Authentication failed
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_INITIATIVE_INVALID_DATE
                message: "Cannot create transaction out of valid period. Initiative startDate: %s endDate: %s"
        "404":
          description: The requested resource was not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_INITIATIVE_NOT_FOUND
                message: "Cannot find initiative with id [%s]"
        "429":
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_TOO_MANY_REQUESTS
                message: Too many requests
        "500":
          description: Generic error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_GENERIC_ERROR
                message: Application error
  /transactions/{transactionId}:
    delete:
      tags:
        - merchant-transactions
      summary: "ENG: Merchant delete transaction - IT: Cancellazione transazione da parte dell'esercente"
      operationId: deleteTransaction
      parameters:
        - name: transactionId
          in: path
          description: The transaction ID
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Ok
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_INVALID_REQUEST
                message: Something went wrong handling the request
        "401":
          description: Authentication failed
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_NOT_ALLOWED_MISMATCHED_MERCHANT
                message: "The merchant with id [%s] associated to the transaction is not equal to the merchant with id [%s]"
        "404":
          description: The requested resource was not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_NOT_FOUND_OR_EXPIRED
                message: "Cannot find transaction with transactionId [%s]"
        "429":
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_TOO_MANY_REQUESTS
                message: Too many requests
        "500":
          description: Generic error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_GENERIC_ERROR
                message: Application error
  /initiatives/{initiativeId}/transactions:
    get:
      tags:
        - merchant-transactions
      summary: "ENG: Returns the list of in progress transactions associated to a merchant - IT: Ritorna la lista delle transazioni in corso associate ad un esercente"
      description: "ENG: Returns the list of in progress transactions associated to a merchant <br> IT: Ritorna la lista delle transazioni in corso associate ad un esercente"
      operationId: getMerchantTransactions
      parameters:
        - name: initiativeId
          in: path
          description: The initiative ID
          required: true
          schema:
            type: string
        - name: page
          in: query
          required: false
          schema:
            type: integer
            format: int32
        - name: size
          in: query
          required: false
          schema:
            type: integer
            format: int32
        - name: fiscalCode
          in: query
          description: Fiscal Code
          required: false
          schema:
            type: string
        - name: status
          in: query
          description: Transaction status
          required: false
          schema:
            type: string
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantTransactionsListDTO"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_INVALID_REQUEST
                message: Something went wrong handling the request
        "401":
          description: Authentication failed
        "429":
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_TOO_MANY_REQUESTS
                message: Too many requests
        "500":
          description: Generic error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_GENERIC_ERROR
                message: Application error
  /initiatives/{initiativeId}/transactions/processed:
    get:
      tags:
        - merchant-transactions
      summary: "ENG: Returns the list of processed transactions associated to a merchant - IT: Ritorna la lista delle transazioni processate associate ad un esercente"
      description: "ENG: Returns the list of processed transactions associated to a merchant <br> IT: Ritorna la lista delle transazioni processate associate ad un esercente"
      operationId: getMerchantTransactionsProcessed
      parameters:
        - name: initiativeId
          in: path
          description: The initiative ID
          required: true
          schema:
            type: string
        - name: page
          in: query
          required: false
          schema:
            type: integer
            format: int32
        - name: size
          in: query
          required: false
          schema:
            type: integer
            format: int32
        - name: fiscalCode
          in: query
          description: Fiscal Code
          required: false
          schema:
            type: string
        - name: status
          in: query
          description: Transaction status
          required: false
          schema:
            type: string
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantTransactionsProcessedListDTO"
        "401":
          description: Autentication failed
        "404":
          description: The requested resource was not found
        "429":
          description: Too many requests
        "500":
          description: Generic error
  /transactions/bar-code/{trxCode}/authorize:
    put:
      tags:
        - merchant-transactions
      summary: "ENG: Authorize payment - IT: Autorizzazione pagamento"
      operationId: authPaymentBarCode
      parameters:
        - name: trxCode
          in: path
          description: "ENG: The transaction's code - IT: Codice della transazione"
          required: true
          schema:
            type: string
      requestBody:
        description: Request about auth bar-code trx
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthBarCodePaymentDTO"
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthPaymentResponseDTO"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_AMOUNT_NOT_VALID
                message: "Cannot authorize transaction with invalid amount [%s]"
        "401":
          description: Authentication failed
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_ALREADY_AUTHORIZED
                message: "Transaction with trxCode [trxCode] is already authorized"
        "404":
          description: The requested resource was not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_NOT_FOUND_EXPIRED
                message: "Cannot find transaction with trxCode [trxCode]"
        "429":
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_TOO_MANY_REQUESTS
                message: Too many request on the ms reward calculator
        "500":
          description: Generic error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: PAYMENT_GENERIC_ERROR
                message: A generic error occured
  /{pointOfSaleId}/transactions/{transactionId}/download:
    get:
      tags:
        - transaction
      summary: "ENG: Download invoice file - IT: Scarica il file della fattura"
      description: "ENG: Download the invoice file of the transaction<br>
        IT: Scarica il file della fattura della transazione"
      operationId: downloadInvoiceFile
      parameters:
        - name: pointOfSaleId
          in: path
          description: "ENG: Point of sale ID - IT: ID del punto vendita"
          required: true
          schema:
            type: string
        - name: transactionId
          in: path
          description: "ENG: Transaction ID - IT: ID della transazione"
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref:
                  "#/components/schemas/DownloadInvoiceResponseDTO"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: INVALID_REQUEST
                message: Something went wrong handling request
        "401":
          description: Authentication failed
        "429":
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: TOO_MANY_REQUESTS
                message: Too many requests
        "500":
          description: Generic error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionErrorDTO"
              example:
                code: GENERIC_ERROR
                message: An error occurred during file reading
  /initiatives/{initiativeId}:
    get:
      tags:
        - merchant-detail
      summary: "ENG: Returns the merchant detail on initiative - IT: Ritorna il dettaglio dell' esercente sull'iniziativa"
      description: "ENG: Returns the merchant detail on initiative <br> IT: Dettaglio dell' esercente sull'iniziativa"
      operationId: getMerchantDetail
      parameters:
        - name: initiativeId
          in: path
          description: The initiative ID
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantDetailDTO"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantErrorDTO"
              example:
                code: MERCHANT_INVALID_REQUEST
                message: Something went wrong handling request
        "401":
          description: Authentication failed
        "404":
          description: The requested ID was not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantErrorDTO"
              example:
                code: MERCHANT_NOT_ONBOARDED
                message: The current merchant is not onboarded on initiative
        "429":
          description: Too many Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantErrorDTO"
              example:
                code: MERCHANT_TOO_MANY_REQUESTS
                message: Too many requests
        "500":
          description: Server ERROR
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantErrorDTO"
              example:
                code: MERCHANT_GENERIC_ERROR
                message: An error occurred during file reading
    patch:
      tags:
        - merchant-detail
      summary: Update merchant IBAN
      description: "ENG: Update the IBAN of a merchant for a specific initiative <br> IT: Aggiornamento dell'IBAN di un esercente per una specifica iniziativa"
      operationId: updateMerchantIban
      parameters:
        - name: initiativeId
          in: path
          description: The initiative ID
          required: true
          schema:
            type: string
      requestBody:
        description: The IBAN to be updated
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MerchantIbanPatchDTO"
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantDetailDTO"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantErrorDTO"
              example:
                code: MERCHANT_INVALID_REQUEST
                message: Something went wrong handling request
        "401":
          description: Authentication failed
        "404":
          description: The requested ID was not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantErrorDTO"
              example:
                code: MERCHANT_NOT_ONBOARDED
                message: The current merchant is not onboarded on initiative
        "429":
          description: Too many Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantErrorDTO"
              example:
                code: MERCHANT_TOO_MANY_REQUESTS
                message: Too many requests
        "500":
          description: Server ERROR
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantErrorDTO"
              example:
                code: MERCHANT_GENERIC_ERROR
                message: An error occurred during the update
  /reported-user/{userFiscalCode}:
    post:
      tags: [ reported-user ]
      summary: Create reported user
      description: >
        ENG: Flag a user (fiscal code) for a merchant/initiative pair
        IT: Segnala un utente (CF) per coppia merchant/iniziativa
      operationId: createReportedUser
      parameters:
        - name: userFiscalCode
          in: path
          required: true
          description: Citizen fiscal code of the reported user
          schema: { type: string, maxLength: 16, pattern: '^[A-Z0-9]{11,16}$' }
          example: RSSMRA85T10A562S
        - $ref: '#/components/parameters/InitiativeIdHeader'
      responses:
        "200":
          description: Business outcome
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportedUserCreateResponseDTO'
              examples:
                ok: { value: { status: "OK", errorKey: "" } }
                entityNotFound: { value: { status: "KO", errorKey: "Entity not found" } }
                serviceUnavailable: { value: { status: "KO", errorKey: "Service unavailable" } }
                differentMerchant: { value: { status: "KO", errorKey: "Different Merchant Id" } }
                differentInitiative: { value: { status: "KO", errorKey: "Different Initiative Id" } }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MerchantErrorDTO' }
              example: { code: MERCHANT_INVALID_REQUEST, message: "Invalid request" }
        "401":
          description: Authentication failed
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MerchantErrorDTO' }
        "429":
          description: Too Many Requests
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MerchantErrorDTO' }
              example: { code: MERCHANT_TOO_MANY_REQUESTS, message: "Too many requests" }
        "500":
          description: Server error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MerchantErrorDTO' }

    get:
      tags: [ reported-user ]
      summary: Search reported users
      description: >
        ENG: Search reported users by fiscal code (headers define merchant/initiative)
        IT: Ricerca segnalazioni per codice fiscale (merchant/initiative via header)
      operationId: getReportedUser
      parameters:
        - name: userFiscalCode
          in: path
          required: true
          description: Citizen fiscal code of the reported user
          schema: { type: string, maxLength: 16, pattern: '^[A-Z0-9]{11,16}$' }
          example: RSSMRA85T10A562S
        - $ref: '#/components/parameters/InitiativeIdHeader'
      responses:
        '200':
          description: Ok
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReportedUserDTO'
              examples:
                list:
                  value:
                    - fiscalCode: "RSSMRA85T10A562S"
                      reportedDate: "2025-10-30T09:15:12Z"
                      transactionId: "TRX_001"
                      transactionDate: "2025-10-30T09:14:50Z"
                    - fiscalCode: "VRDLGI90A01H501Z"
                      reportedDate: "2025-10-29T16:02:45Z"
                      transactionId: "TRX_002"
                      transactionDate: "2025-10-29T15:59:10Z"
        '400':
          description: Bad request
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MerchantErrorDTO' }
              example: { code: MERCHANT_INVALID_REQUEST, message: "Invalid request" }
        '401':
          description: Authentication failed
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MerchantErrorDTO' }
        '429':
          description: Too Many Requests
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MerchantErrorDTO' }
              example: { code: MERCHANT_TOO_MANY_REQUESTS, message: "Too many requests" }
        '500':
          description: Server error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MerchantErrorDTO' }
    delete:
      tags: [ reported-user ]
      summary: Delete reported user
      description: >
        ENG: Remove a report for the given fiscal code
        IT: Rimuove la segnalazione per il codice fiscale indicato
      operationId: deleteReportedUser
      parameters:
        - name: userFiscalCode
          in: path
          required: true
          description: Citizen fiscal code of the reported user
          schema: { type: string, maxLength: 16, pattern: '^[A-Z0-9]{11,16}$' }
          example: RSSMRA85T10A562S
        - $ref: '#/components/parameters/InitiativeIdHeader'
      responses:
        '200':
          description: Business outcome
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ReportedUserCreateResponseDTO' }
              examples:
                ok: { value: { status: "OK", errorKey: "" } }
                notFound: { value: { status: "KO", errorKey: "UserId not found" } }
                entityNotFound: { value: { status: "KO", errorKey: "Entity not found" } }
                serviceUnavailable: { value: { status: "KO", errorKey: "Service unavailable" } }
                differentMerchant: { value: { status: "KO", errorKey: "Different Merchant Id" } }
                differentInitiative: { value: { status: "KO", errorKey: "Different Initiative Id" } }
        '400':
          description: Bad request
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MerchantErrorDTO' }
              example: { code: MERCHANT_INVALID_REQUEST, message: "Invalid request" }
        '401':
          description: Authentication failed
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MerchantErrorDTO' }
        '403':
          description: Not authorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MerchantErrorDTO' }
        '429':
          description: Too Many Requests
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MerchantErrorDTO' }
              example: { code: MERCHANT_TOO_MANY_REQUESTS, message: "Too many requests" }
        '500':
          description: Server error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MerchantErrorDTO' }
components:
  headers:
      X-RateLimit-Limit:
        description: The maximum number of requests allowed in the current period
        schema:
          type: integer
          format: int64
          minimum: 0
          maximum: 1000000
      X-RateLimit-Remaining:
        description: The number of requests remaining in the current period
        schema:
          type: integer
          format: int64
          minimum: 0
          maximum: 1000000
      X-RateLimit-Reset:
        description: The time at which the rate limit resets (in UTC epoch seconds)
        schema:
          type: integer
          format: int64
          minimum: 0
          maximum: 9999999999
      Access-Control-Allow-Origin:
        description: CORS header to allow cross-origin requests
        schema:
          type: string
          maxLength: 255
          pattern: .*
      Retry-After:
        description:
          Indicates how long the user agent should wait before making a follow-up
          request
        schema:
          type: integer
          format: int64
          minimum: 0
          maximum: 86400
  parameters:
    MerchantIdHeader:
      name: merchant-id
      in: header
      required: true
      description: Merchant ID (header)
      schema: { type: string, maxLength: 64, pattern: '^[A-Z0-9\-_]+$' }
      example: MERCHANT_12345
    InitiativeIdHeader:
      name: initiative-id
      in: header
      required: true
      description: Initiative ID (header)
      schema: { type: string, maxLength: 64, pattern: '^[A-Z0-9\-_]+$' }
      example: INITIATIVE_67890
  schemas:
    InitiativeDTO:
      type: object
      properties:
        initiativeId:
          type: string
        initiativeName:
          type: string
        organizationName:
          type: string
        status:
          type: string
          enum:
            - PUBLISHED
            - APPROVED
            - IN_REVISION
            - TO_CHECK
            - SUSPENDED
            - DRAFT
            - CLOSED
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        serviceId:
          type: string
        enabled:
          type: boolean
    MerchantStatisticsDTO:
      type: object
      properties:
        amountCents:
          type: integer
          format: int64
          example: 100
        accruedCents:
          type: integer
          format: int64
          example: 100
        refundedCents:
          type: integer
          format: int64
          example: 100
    MerchantTransactionsListDTO:
      type: object
      required:
        - content
        - pageNo
        - pageSize
        - totalElements
        - totalPages
      properties:
        content:
          type: array
          items:
            $ref: "#/components/schemas/MerchantTransactionDTO"
        pageNo:
          type: integer
          format: int32
        pageSize:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int32
        totalPages:
          type: integer
          format: int32
    MerchantTransactionDTO:
      type: object
      required:
        - trxCode
        - trxId
        - effectiveAmountCents
        - trxExpirationSeconds
        - status
      properties:
        trxCode:
          type: string
          description: "ENG: Transaction code - IT: Il codice della transazione"
        trxId:
          type: string
          description: "ENG: Transaction ID - IT: L'ID della transazione"
        fiscalCode:
          type: string
          description: "ENG: Citizen fiscal code - IT: Codice fiscale del cittadino"
        effectiveAmountCents:
          type: integer
          format: int64
          description: "ENG: Transaction amount - IT: Quantitativo della transazione"
          example: 100
        rewardAmountCents:
          type: integer
          format: int64
          description: "ENG: Reward amount - IT: Premio generato"
          example: 100
        trxDate:
          type: string
          format: date-time
          description: "ENG: The date of the transaction - IT: La data della transazione"
        trxExpirationSeconds:
          type: number
          description: "ENG: Expiration time of the transaction, in seconds - IT: Scadenza della transazione, in secondi"
        updateDate:
          type: string
          format: date-time
          description: "ENG: The date of the transaction update - IT: La data di aggiornamento della transazione"
        status:
          type: string
          enum:
            - CREATED
            - IDENTIFIED
            - AUTHORIZATION_REQUESTED
            - AUTHORIZED
            - REJECTED
          description: "ENG: Status of the transaction - IT: Stato della transazione"
        splitPayment:
          type: boolean
          description: "ENG: TRUE, if the authorized sum is less than the requested sum or FALSE, if the authorized sum is equal to the requested sum - IT: TRUE, se la somma autorizzata  inferiore alla somma richiesta o FALSE, se la somma autorizzata  uguale alla somma richiesta."
        residualAmountCents:
          type: integer
          format: int64
          description: "ENG: Remaining amount to be paid if the authorized sum is less than the requested sum - IT: Importo restante da pagare nel caso in cui la somma autorizzata sia inferiore alla somma richiesta."
        channel:
          type: string
          description: "ENG: Channel from which the transaction takes place - IT: Canale da cui avviene la transazione"
        qrcodePngUrl:
          type: string
          description: "ENG: Url to the QR code image - IT: Url all'immagine del QR code"
        qrcodeTxtUrl:
          type: string
          description: "ENG: Url of the QR code link - IT: Url del QR code"
        additionalProperties:
          type: object
          additionalProperties:
            type: string
          description: "ENG: Additional properties of the transaction - IT: Propriet aggiuntive della transazione"
    MerchantTransactionsProcessedListDTO:
      type: object
      required:
        - content
        - pageNo
        - pageSize
        - totalElements
        - totalPages
      properties:
        content:
          type: array
          items:
            $ref: "#/components/schemas/MerchantTransactionProcessedDTO"
        pageNo:
          type: integer
          format: int32
          description: "ENG: The number of the page - IT: Il numero della pagina"
        pageSize:
          type: integer
          format: int32
          description: "ENG: The element size for page - IT: Il numero di elementi per pagina"
        totalElements:
          type: integer
          format: int32
          description: "ENG: The total number of the elements - IT: Il numero totale degli elementi"
        totalPages:
          type: integer
          format: int32
          description: "ENG: The total number of the pages - IT: Il numero totale delle pagine"
    MerchantTransactionProcessedDTO:
      type: object
      required:
        - trxId
        - effectiveAmountCents
        - status
      properties:
        trxId:
          type: string
          description: "ENG: Transaction ID - IT: L'ID della transazione"
        fiscalCode:
          type: string
          description: "ENG: Citizen fiscal code - IT: Codice fiscale del cittadino"
        effectiveAmountCents:
          type: integer
          format: int64
          description: "ENG: Transaction amount - IT: Quantitativo della transazione"
          example: 100
        rewardAmountCents:
          type: integer
          format: int64
          description: "ENG: Reward amount - IT: Premio generato"
          example: 100
        trxDate:
          type: string
          format: date-time
          description: "ENG: The date of the transaction - IT: La data della transazione"
        updateDate:
          type: string
          format: date-time
          description: "ENG: The date of the transaction update - IT: La data di aggiornamento della transazione"
        status:
          type: string
          enum:
            - REWARDED
            - CANCELLED
          description: "ENG: Status of the transaction - IT: Stato della transazione"
        channel:
          type: string
          description: "ENG: Channel from which the transaction takes place - IT: Canale da cui avviene la transazione"
    MerchantDetailDTO:
      type: object
      properties:
        initiativeId:
          type: string
          description: "ENG: The ID of the initiative <br> IT: L'ID' dell'iniziativa"
        initiativeName:
          type: string
          description: "ENG: The name of the initiative <br> IT: Il nome dell'iniziativa"
        businessName:
          type: string
          description: "ENG: The name of the merchant <br> IT: La ragione sociale dell'esercente"
        legalOfficeAddress:
          type: string
          description: "ENG: The address of the legal office <br> IT: L'indirizzo della sede legale"
        legalOfficeMunicipality:
          type: string
          description: "ENG: The municipality of the legal office <br> IT: Il comune della sede legale"
        legalOfficeProvince:
          type: string
          description: "ENG: The province of the legal office <br> IT: La provincia della sede legale"
        legalOfficeZipCode:
          type: string
          description: "ENG: The zipcode of the legal office <br> IT: Il CAP della sede legale"
        certifiedEmail:
          type: string
          description: "ENG: The certified email address of the merchant <br> IT: L'indirizzo email PEC dell' esercente"
        fiscalCode:
          type: string
          description: "ENG: The fiscal code/vat number of the merchant <br> IT: Il codice fiscale/partita iva dell'esercente"
        vatNumber:
          type: string
          description: "ENG: The vat number of the merchant <br> IT: La partita iva dell'esercente"
        status:
          type: string
          enum:
            - UPLOADED
          description: "ENG: One of the possible merchant onboarding status: <ul><li>UPLOADED:This is the initial status after the csv upload</li></ul>IT: Uno dei possibili stati dell'onboarding da parte dell'esercente: <ul><li>UPLOADED:Questo  lo stato iniziale dopo il caricamento del file csv</li></ul>"
        iban:
          type: string
          description: "ENG: The iban of the merchant <br> IT: L'iban dell'esercente"
        ibanHolder:
          type: string
          description: "ENG: The holder of the IBAN <br> IT: L'intestatario dell'IBAN"
        creationDate:
          type: string
          format: date-time
          description: "ENG: Time and date of the initiative creation <br> IT: La data ed ora della creazione dell'iniziativa"
        updateDate:
          type: string
          format: date-time
          description: "ENG: Time and date of the last status update <br> IT: La data ed ora dell'ultimo aggiornamento dello stato"
        activationDate:
          type: string
          format: date-time
          description: "ENG: Time and date of the merchant activation date <br> IT: La data ed ora di attivazione dell'esercente"
    TransactionCreationRequest:
      type: object
      required:
        - initiativeId
        - amountCents
        - idTrxAcquirer
      properties:
        initiativeId:
          type: string
        amountCents:
          type: integer
          format: int64
        mcc:
          type: string
        idTrxAcquirer:
          type: string
        additionalProperties:
          type: object
          additionalProperties:
            type: string
    TransactionResponse:
      type: object
      required:
        - id
        - trxCode
        - initiativeId
        - merchantId
        - idTrxAcquirer
        - trxDate
        - trxExpirationSeconds
        - amountCents
        - amountCurrency
        - acquirerId
        - status
        - qrcodePngUrl
        - qrcodeTxtUrl
      properties:
        id:
          type: string
        trxCode:
          type: string
        initiativeId:
          type: string
        merchantId:
          type: string
        idTrxAcquirer:
          type: string
        trxDate:
          type: string
          format: date-time
        trxExpirationSeconds:
          type: number
        amountCents:
          type: integer
          format: int64
        amountCurrency:
          type: string
        mcc:
          type: string
        acquirerId:
          type: string
        status:
          type: string
          enum:
            - CREATED
            - IDENTIFIED
            - AUTHORIZED
            - REWARDED
            - REJECTED
        merchantFiscalCode:
          type: string
        vat:
          type: string
        splitPayment:
          type: boolean
        residualAmountCents:
          type: integer
          format: int64
        qrcodePngUrl:
          type: string
        qrcodeTxtUrl:
          type: string
        additionalProperties:
          type: object
          additionalProperties:
            type: string
    AuthPaymentResponseDTO:
      type: object
      required:
        - id
        - trxCode
        - initiativeId
        - status
        - amountCents
      properties:
        id:
          type: string
          description: "ENG: Id of the payment - IT: Identificativo del pagamento"
        trxCode:
          type: string
          description: "ENG: Transaction code - IT: Codice della transazione"
        trxDate:
          type: string
          format: date-time
          description: "ENG: Transaction date - IT: Data della transazione"
        initiativeId:
          type: string
          description: "ENG: Id of the initiative - IT: Identificativo dell'iniziativa"
        initiativeName:
          type: string
          description: "ENG: Name of the initiative - IT: Nome della iniziativa"
        businessName:
          type: string
          description: "ENG: Business name - IT: Nome dell'esercente"
        status:
          type: string
          enum:
            - CREATED
            - IDENTIFIED
            - AUTHORIZATION_REQUESTED
            - AUTHORIZED
          description: "ENG: Status of the payment [CREATED: Created, IDENTIFIED: User related, AUTHORIZATION_REQUESTED: Authorization Requested, AUTHORIZED: authorized] - IT: Stato del pagamento [CREATED: Creato, IDENTIFIED: Utente associato, AUTHORIZATION_REQUESTED: autorizzazione richiesta, AUTHORIZED: autorizzato]"
        rewardCents:
          type: integer
          format: int64
          description: "ENG: Reward - IT: Premio generato"
        amountCents:
          type: integer
          format: int64
          description: "ENG: Amount cents - IT: Importo in centessimi"
        residualBudgetCents:
          type: integer
          format: int64
          description: "ENG: Residual budget - IT: Budget residuo"
        splitPayment:
          type: boolean
          description: "ENG: TRUE, if the authorized sum is less than the requested sum or FALSE, if the authorized sum is equal to the requested sum - IT: TRUE, se la somma autorizzata  inferiore alla somma richiesta o FALSE, se la somma autorizzata  uguale alla somma richiesta."
        residualAmountCents:
          type: integer
          format: int64
          description: "ENG: Remaining amount to be paid if the authorized sum is less than the requested sum - IT: Importo restante da pagare nel caso in cui la somma autorizzata sia inferiore alla somma richiesta."
    TransactionErrorDTO:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          enum:
            - PAYMENT_NOT_FOUND_EXPIRED
            - PAYMENT_NOT_FOUND_OR_EXPIRED
            - PAYMENT_TRANSACTION_EXPIRED
            - PAYMENT_INITIATIVE_NOT_FOUND
            - PAYMENT_INITIATIVE_INVALID_DATE
            - PAYMENT_INITIATIVE_NOT_DISCOUNT
            - PAYMENT_ALREADY_AUTHORIZED
            - PAYMENT_ALREADY_CANCELLED
            - PAYMENT_BUDGET_EXHAUSTED
            - PAYMENT_GENERIC_REJECTED
            - PAYMENT_TOO_MANY_REQUESTS
            - PAYMENT_GENERIC_ERROR
            - PAYMENT_USER_SUSPENDED
            - PAYMENT_USER_NOT_ONBOARDED
            - PAYMENT_USER_UNSUBSCRIBED
            - PAYMENT_ALREADY_ASSIGNED
            - PAYMENT_NOT_ALLOWED_FOR_TRX_STATUS
            - PAYMENT_NOT_ALLOWED_MISMATCHED_MERCHANT
            - PAYMENT_USER_NOT_ASSOCIATED
            - PAYMENT_DELETE_NOT_ALLOWED_FOR_TRX_STATUS
            - PAYMENT_UNRELATE_NOT_ALLOWED_FOR_TRX_STATUS
            - PAYMENT_AMOUNT_NOT_VALID
            - PAYMENT_MERCHANT_NOT_ONBOARDED
            - PAYMENT_INVALID_REQUEST
            - PAYMENT_STATUS_NOT_VALID
            - PAYMENT_TRANSACTION_VERSION_PENDING
          description: '"ENG: Error code:<br> PAYMENT_NOT_FOUND_OR_EXPIRED: transaction not found or expired<br> PAYMENT_TRANSACTION_EXPIRED: transaction expired<br> PAYMENT_INITIATIVE_NOT_FOUND: initiative not found<br> PAYMENT_INITIATIVE_INVALID_DATE: initiative invalid date<br> PAYMENT_INITIATIVE_NOT_DISCOUNT: initiative is not of discount type<br> PAYMENT_ALREADY_AUTHORIZED: transaction already authorized<br> PAYMENT_ALREADY_CANCELLED: transaction already cancelled<br> PAYMENT_BUDGET_EXHAUSTED: budget exhausted<br> PAYMENT_GENERIC_REJECTED: generic rejected error (transaction rejected)<br> PAYMENT_TOO_MANY_REQUESTS: too many request, retry<br> PAYMENT_GENERIC_ERROR: application error (connection microservice error)<br> PAYMENT_USER_SUSPENDED: the user has been suspended on the initiative<br> PAYMENT_USER_NOT_ONBOARDED: user not onboarded<br> PAYMENT_USER_UNSUBSCRIBED: user unsubscribed<br> PAYMENT_ALREADY_ASSIGNED:  transaction already assigned<br> PAYMENT_NOT_ALLOWED_FOR_TRX_STATUS: operation on transaction not allowed due to status<br> PAYMENT_NOT_ALLOWED_MISMATCHED_MERCHANT: operation on transaction not allowed due to merchant mismatched<br> PAYMENT_USER_NOT_ASSOCIATED: user not associated to the transaction<br> PAYMENT_DELETE_NOT_ALLOWED_FOR_TRX_STATUS: cancellation of transaction not allowed due to status<br> PAYMENT_UNRELATE_NOT_ALLOWED_FOR_TRX_STATUS: unrelate transaction not allowed due to status<br> PAYMENT_AMOUNT_NOT_VALID: amount of transaction not valid<br> PAYMENT_MERCHANT_NOT_ONBOARDED: the merchant is not onboarded<br> PAYMENT_INVALID_REQUEST: request validation error<br> PAYMENT_STATUS_NOT_VALID: transaction status not valid<br> PAYMENT_TRANSACTION_VERSION_PENDING: The transaction version is actually locked<br> IT: Codice di errore<br> PAYMENT_NOT_FOUND_OR_EXPIRED: transazione non trovata oppure scaduta<br> PAYMENT_TRANSACTION_EXPIRED: transazione scaduta<br> PAYMENT_INITIATIVE_NOT_FOUND: iniziativa non trovata<br> PAYMENT_INITIATIVE_INVALID_DATE: iniziativa con data invalida<br> PAYMENT_INITIATIVE_NOT_DISCOUNT: iniziativa non  di tipo a sconto<br> PAYMENT_ALREADY_AUTHORIZED: transazione gi autorizzata<br> PAYMENT_ALREADY_CANCELLED: transazione gi cancellata<br> PAYMENT_BUDGET_EXHAUSTED: budget esaurito<br> PAYMENT_GENERIC_REJECTED: errore generico, transazione rigettata<br> PAYMENT_TOO_MANY_REQUESTS: troppe richieste, riprovare<br> PAYMENT_GENERIC_ERROR: errore generico (errore nella connessione ad un microservizio)<br> PAYMENT_USER_SUSPENDED: l''utente  stato sospeso dall''iniziativa<br> PAYMENT_USER_NOT_ONBOARDED: utente non onboardato all''iniziativa<br> PAYMENT_USER_UNSUBSCRIBED: utente disiscritto dall''iniziativa<br> PAYMENT_ALREADY_ASSIGNED:  transazione gi assegnata<br> PAYMENT_NOT_ALLOWED_FOR_TRX_STATUS: transazione non consentita a causa dello stato della transazione<br> PAYMENT_NOT_ALLOWED_MISMATCHED_MERCHANT: transazione non consentita a causa della mancata corrispondenza del merchant<br> PAYMENT_USER_NOT_ASSOCIATED: utente non associato alla transazione<br> PAYMENT_DELETE_NOT_ALLOWED_FOR_TRX_STATUS: annullamento della transazione non consentito a causa dello stato della transazione<br> PAYMENT_UNRELATE_NOT_ALLOWED_FOR_TRX_STATUS: disassociazione non consentita a causa dello stato della transazione<br> PAYMENT_AMOUNT_NOT_VALID: importo nella transazione non valido<br> PAYMENT_MERCHANT_NOT_ONBOARDED: il merchant non  onboardato<br> PAYMENT_INVALID_REQUEST: errore di validazione della richiesta<br> PAYMENT_STATUS_NOT_VALID: stato della transazione non valido"<br> PAYMENT_TRANSACTION_VERSION_PENDING: La versione del contatore  attualmente bloccata'
        message:
          type: string
          description: "ENG: Error message- IT: Messaggio di errore"
    AuthBarCodePaymentDTO:
      type: object
      required:
        - amountCents
        - idTrxAcquirer
      properties:
        amountCents:
          type: integer
          format: int64
          description: "ENG: Amount of transaction - IT: Importo della transazione"
        idTrxAcquirer:
          type: string
          description: "ENG: Transaction acquirer ID- IT: Identificativo della transazione rispetto all'acquirer"
        additionalProperties:
          type: object
          additionalProperties:
            type: string
    StatisticsErrorDTO:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          enum:
            - STATISTICS_NOT_FOUND
            - STATISTICS_INVALID_REQUEST
            - STATISTICS_TOO_MANY_REQUESTS
            - STATISTICS_GENERIC_ERROR
            - STATISTICS_MANAGER_TOO_MANY_REQUESTS
            - STATISTICS_MANAGER_GENERIC_ERROR
          description: |-
            "ENG: Error code: STATISTICS_NOT_FOUND: Stats not found,
             STATISTICS_INVALID_REQUEST: Something went wrong handling request,
             STATISTICS_TOO_MANY_REQUESTS: Too many requests,
             STATISTICS_GENERIC_ERROR: Application Error - IT: Codice di errore:
             STATISTICS_NOT_FOUND: Statistiche non trovate,
             STATISTICS_INVALID_REQUEST: Qualcosa  andato storto durante l'invio della richiesta,
             STATISTICS_TOO_MANY_REQUESTS: Troppe richieste,
             STATISTICS_GENERIC_ERROR: Errore generico"
        message:
          type: string
          description: "ENG: Error message - IT: Messaggio di errore"
    MerchantErrorDTO:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          enum:
            - MERCHANT_NOT_FOUND
            - MERCHANT_NOT_ONBOARDED
            - MERCHANT_TOO_MANY_REQUESTS
            - MERCHANT_INVALID_REQUEST
            - MERCHANT_GENERIC_ERROR
          description: '"ENG: Error code:<br> MERCHANT_NOT_FOUND: The merchant was not found,<br> MERCHANT_NOT_ONBOARDED: The merchant is not associated to the initiative,<br> MERCHANT_TOO_MANY_REQUESTS: Too many requests,<br> MERCHANT_INVALID_REQUEST: Something went wrong handling the request,<br> MERCHANT_GENERIC_ERROR: Application error,<br> - IT: Codice di errore:<br> MERCHANT_NOT_FOUND: L''esercente non  stato trovato,<br> MERCHANT_NOT_ONBOARDED: L''esercente non  associato all''iniziativa,<br> MERCHANT_TOO_MANY_REQUESTS: Troppe richieste,<br> MERCHANT_INVALID_REQUEST: Qualcosa  andato storto durante l''invio della richiesta,<br> MERCHANT_GENERIC_ERROR: Errore applicativo"'
        message:
          type: string
          description: "ENG: Error message- IT: Messaggio di errore"
    PointOfSaleDTO:
      type: object
      properties:
        id:
          type: string
          description: "ENG: The id for the point of sale <br> IT: Id del punto vendita"
        type:
          type: string
          enum:
            - PHYSICAL
            - ONLINE
          description: "ENG: The type of the point of sale <br> IT: Il tipo del punto vendita"
        franchiseName:
          type: string
          description: "ENG: The name of the point of sale <br> IT: Il nome del punto vendita"
        region:
          type: string
          description: "ENG: The region of the point of sale <br> IT: La regione del punto vendita"
        province:
          type: string
          description: "ENG: The province of the point of sale <br> IT: La provincia del punto vendita"
        city:
          type: string
          description: "ENG: The city of the point of sale <br> IT: La citt del punto vendita"
        zipCode:
          type: string
          description: "ENG: The zip code of the point of sale <br> IT: Il CAP del punto vendita"
        address:
          type: string
          description: "ENG: The address of the point of sale <br> IT: L'indirizzo completo del punto vendita"
        streetNumber:
          type: string
          description: "ENG: The street number of the point of sale <br> IT: Il numero civico del punto vendita"
        website:
          type: string
          description: "ENG: The website of the point of sale <br> IT: Il sito web del punto vendita"
        contactEmail:
          type: string
          description: "ENG: The email of the contact person <br> IT: L'email del referente"
        contactName:
          type: string
          description: "ENG: The name of the contact person <br> IT: Il nome del referente"
        contactSurname:
          type: string
          description: "ENG: The surname of the contact person <br> IT: Il cognome del referente"
        channelEmail:
          type: string
          description: "ENG: Store contact via email address <br> IT: Contatto del punto vendita tramite indirizzo email."
        channelPhone:
          type: string
          description: "ENG: Store contact via phone number <br> IT: Contatto del punto vendita tramite numero di telefono"
        channelGeolink:
          type: string
          description: "ENG: Store contact providing a map link or location for navigation <br> IT: Contatto del punto vendita tramite link geografico o posizione sulla mappa"
        channelWebsite:
          type: string
          description: "ENG: Store contact via a web-based portal <br> IT: Contatto del punto vendita tramite portale web"
        vatNumber:
          type: string
          description: "ENG: The vat number of the merchant <br> IT: La partita iva dell'esercente"
        fiscalCode:
          type: string
          description: "ENG: The fiscal code/vat number of the merchant <br> IT: Il codice fiscale/partita iva dell'esercente"
        businessName:
          type: string
          description: "ENG: The name of the merchant <br> IT: La ragione sociale dell'esercente"
    ListPointOfSaleDTO:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: "#/components/schemas/PointOfSaleDTO"
        pageNumber:
          type: integer
          format: int32
          description: "ENG: The number of the page <br> IT: Il numero della pagina"
        pageSize:
          type: integer
          format: int32
          description: "ENG: The element size for page <br> IT: Il numero di elementi per pagina"
        totalElements:
          type: integer
          format: int32
          description: "ENG: The total number of the elements <br> IT: Il numero totale degli elementi"
        totalPages:
          type: integer
          format: int32
          description: "ENG: The total number of the pages <br> IT: Il numero totale delle pagine"
    PointOfSaleErrorDTO:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          enum:
            - POINT_OF_SALE_NOT_FOUND
            - POINT_OF_SALE_BAD_REQUEST
            - POINT_OF_SALE_INVALID_REQUEST
            - MERCHANT_NOT_ONBOARDED
            - POINT_OF_SALE_TOO_MANY_REQUESTS
            - POINT_OF_SALE_GENERIC_ERROR
          description: '"ENG: Error code:<br> POINT_OF_SALES_NOT_FOUND: The sale was not found,<br> MERCHANT_NOT_ONBOARDED: The merchant is not associated to the initiative,<br> POINT_OF_SALES_TOO_MANY_REQUESTS: Too many requests,<br> POINT_OF_SALES_INVALID_REQUEST: Something went wrong handling the request,<br> POINT_OF_SALES_GENERIC_ERROR: Application error,<br> - IT: Codice di errore:<br> POINT_OF_SALES_NOT_FOUND: Lo store non  stato trovato,<br> MERCHANT_NOT_ONBOARDED: L''esercente non  associato all''iniziativa,<br> POINT_OF_SALES_TOO_MANY_REQUESTS: Troppe richieste,<br> POINT_OF_SALES_INVALID_REQUEST: Qualcosa  andato storto durante l''invio della richiesta,<br> POINT_OF_SALES_GENERIC_ERROR: Errore applicativo"'
        message:
          type: string
          description: "ENG: Error message- IT: Messaggio di errore"
    ValidationErrorDTO:
      type: object
      required:
        - code
        - message
        - errors
      properties:
        code:
          type: string
          enum:
            - VALIDATION_ERROR
        message:
          type: string
          description: Some fields are invalid. See details for more information
        errors:
          type: array
          items:
            $ref: "#/components/schemas/ValidationErrorDetail"
    ValidationErrorDetail:
      type: object
      required:
        - index
        - field
        - value
        - code
        - message
      properties:
        index:
          type: integer
          description: The index of the value
        field:
          type: string
          description: Name of the field where the validation error occured
        value:
          type: string
          description: The value that was provided but rejected due to validation failure
        code:
          type: string
          description: "Specific validation error code (e.g., NotNull)"
        message:
          type: string
          description: Description of the validation error
    MerchantIbanPatchDTO:
      type: object
      properties:
        iban:
          type: string
          description: "ENG: The IBAN of the merchant <br> IT: L'IBAN dell'esercente"
        ibanHolder:
          type: string
          description: "ENG: The holder of the IBAN <br> IT: L'intestatario dell'IBAN"
    PointOfSaleTransactionsProcessedListDTO:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/PointOfSaleTransactionProcessedDTO'
          maxItems: 1000
        pageNo:
          type: integer
          format: int32
          description: 'ENG: The number of the page <br> IT: Il numero della pagina'
          minimum: 0
          maximum: 1000000
        pageSize:
          type: integer
          format: int32
          description: 'ENG: The element size for page <br> IT: Il numero di elementi per pagina'
          minimum: 0
          maximum: 1000000
        totalElements:
          type: integer
          format: int32
          description: 'ENG: The total number of the elements <br> IT: Il numero totale degli elementi'
          minimum: 0
          maximum: 1000000
        totalPages:
          type: integer
          format: int32
          description: 'ENG: The total number of the pages <br> IT: Il numero totale delle pagine'
          minimum: 0
          maximum: 1000000
    PointOfSaleTransactionProcessedDTO:
      type: object
      properties:
        id:
          type: string
          description: 'ENG: Transaction ID <br> IT: ID della transazione'
          maxLength: 64
          pattern: .*
        fiscalCode:
          type: string
          description: 'ENG: Citizen fiscal code - IT: Codice fiscale del cittadino'
          maxLength: 16
          pattern: .*
        effectiveAmountCents:
          type: integer
          format: int64
          description: 'ENG: Transaction amount in cents - IT: Importo della transazione in centesimi'
          minimum: -1000000000
          maximum: 1000000000
        rewardAmountCents:
          type: integer
          format: int64
          description: 'ENG: Reward amount in cents - IT: Premio generato in centesimi'
          minimum: -1000000000
          maximum: 1000000000
        authorizedAmountCents:
          type: integer
          format: int64
          description: "ENG: Authorized amount in cents - IT: Importo autorizzato in centesimi"
          minimum: 0
          maximum: 1000000000
        trxDate:
          type: string
          format: date-time
          description: 'ENG: The date of the transaction - IT: La data della transazione'
          maxLength: 255
        trxChargeDate:
          type: string
          format: date-time
          description: "ENG: Payment authorization date - IT: La data di autorizzazione del pagamento"
          maxLength: 255
        updateDate:
          type: string
          format: date-time
          description: 'ENG: The date of the transaction update - IT: La data di aggiornamento della transazione'
          maxLength: 255
        status:
          type: string
          description: 'ENG: The status of the transaction - IT: Lo stato della transazione'
          enum:
            - REWARDED
            - CANCELLED
            - REFUNDED
            - INVOICED
        channel:
          type: string
          description: 'ENG: Channel from which the transaction takes place - IT: Canale da cui avviene la transazione'
          maxLength: 24
        additionalProperties:
          type: object
          additionalProperties:
            type: string
        invoiceFile:
          $ref: '#/components/schemas/InvoiceFileDTO'
    InvoiceFileDTO:
      type: object
      properties:
        filename:
          type: string
          description: 'ENG: The name of the invoice file <br> IT: Il nome del file della fattura'
        docNumber:
          type: string
          maxLength: 255
    DownloadInvoiceResponseDTO:
      type: object
      properties:
        invoiceUrl:
          type: string
          description: "ENG: URL to download the invoice file - IT: URL per scaricare il file della fattura"
      required:
        - invoiceUrl
    ReportedUserCreateResponseDTO:
      type: object
      properties:
        status:
          type: string
          description: Outcome of the operation
          example: OK
        errorKey:
          type: string
          nullable: true
          description: >
            Error reason if status == KO; empty string otherwise.
            Possible business messages:
             - "UserId not found"
             - "Entity not found"
             - "Service unavailable"
             - "Different Merchant Id"
             - "Already reported"
             - "Different Initiative Id"
          maxLength: 64
          example: ""
      required: [ status, errorKey ]
    ReportedUserDTO:
      type: object
      required: [ fiscalCode, reportedDate ]
      properties:
        fiscalCode: { type: string, maxLength: 16, pattern: '^[A-Z0-9]{11,16}$', description: Citizen fiscal code, example: RSSMRA85T10A562S }
        reportedDate: { type: string, format: date-time, maxLength: 64, description: When the user was reported, example: '2025-10-30T09:15:12Z' }
        transactionId: { type: string, nullable: true, maxLength: 64, description: Related transaction ID (if any), example: TRX_001 }
        trxChargeDate: { type: string, format: date-time, nullable: true, maxLength: 64, description: Related transaction date (if any), example: '2025-10-30T09:14:50Z' }
    RewardBatchListDTO:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/RewardBatchDTO'
          maxItems: 1000
        pageNo:
          type: integer
          format: int32
          description: 'ENG: The number of the page <br> IT: Il numero della pagina'
          minimum: 0
          maximum: 1000000
        pageSize:
          type: integer
          format: int32
          description: 'ENG: The element size for page <br> IT: Il numero di elementi per pagina'
          minimum: 0
          maximum: 1000000
        totalElements:
          type: integer
          format: int32
          description: 'ENG: The total number of the elements <br> IT: Il numero totale degli elementi'
          minimum: 0
          maximum: 1000000
        totalPages:
          type: integer
          format: int32
          description: 'ENG: The total number of the pages <br> IT: Il numero totale delle pagine'
          minimum: 0
          maximum: 1000000
    RewardBatchDTO:
      type: object
      properties:
        id:
          type: string
          description: 'ENG: Reward Batch ID <br> IT: ID del lotto'
          maxLength: 64
          pattern: .*
        name:
          type: string
          description: 'ENG: Reward Batch name - IT: Nome del lotto'
          maxLength: 255
          pattern: .*
          example: 'novembre 2025 - fisico - rigettati'
        status:
          type: string
          description: 'ENG: Reward Batch status - IT: Lo stato del lotto'
          enum:
            - CREATED
            - EVALUATING
            - APPROVED
        posType:
          type: string
          description: 'ENG: Point of sales type - IT: Il tipo di punto vendita'
          enum:
            - PHYSICAL
            - ONLINE
        totalAmountCents:
          type: integer
          format: int64
          example: 100
    RewardBatchErrorDTO:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          enum:
            - REWARD_BATCH_NOT_FOUND
            - REWARD_BATCH_INVALID_REQUEST
            - REWARD_BATCH_TOO_MANY_REQUESTS
            - REWARD_BATCH_GENERIC_ERROR
          description: |-
            "ENG: Error code: REWARD_BATCH_NOT_FOUND: Reward Batch not found,
             REWARD_BATCH_INVALID_REQUEST: Something went wrong handling request,
             REWARD_BATCH_TOO_MANY_REQUESTS: Too many requests,
             REWARD_BATCH_GENERIC_ERROR: Application Error - IT: Codice di errore:
             REWARD_BATCH_NOT_FOUND: lotto non trovato,
             REWARD_BATCH_INVALID_REQUEST: Qualcosa  andato storto durante l'invio della richiesta,
             REWARD_BATCH_TOO_MANY_REQUESTS: Troppe richieste,
             REWARD_BATCH_GENERIC_ERROR: Errore generico"
        message:
          type: string
          description: "ENG: Error message - IT: Messaggio di errore"
  securitySchemes:
    Bearer:
      type: apiKey
      name: Authorization
      in: header
security:
  - Bearer: []